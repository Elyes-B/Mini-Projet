<?php
    include 'db.php';
$cartCount = 0;
if (isset($_SESSION['client_id'])) {
    $stmt = $pdo->prepare("SELECT SUM(cart_quantity) AS total FROM Article_Panier WHERE client_id = :client_id");
    $stmt->execute(['client_id' => (int)$_SESSION['client_id']]);
    $result = $stmt->fetch();
    $cartCount = $result ? (int)$result['total'] : 0;
}

$wishListCount = 0;
if (isset($_SESSION['client_id'])) {
    $stmt = $pdo->prepare("SELECT COUNT(*) AS total FROM Article_Souhaits WHERE client_id = :client_id");
    $stmt->execute(['client_id' => (int)$_SESSION['client_id']]);
    $result = $stmt->fetch();
    $wishListCount = $result ? (int)$result['total'] : 0;
}

$categories = [];
$stmt = $pdo->query("SELECT DISTINCT cat_name FROM Categorie");
while ($row = $stmt->fetch()) {
    $categories[] = $row['cat_name'];
}
?>
<header class="sticky-header">
    <div class="top-header py-2 bg-dark text-white">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="contact-info">
                    <span class="me-3"><i class="fas fa-phone"></i> +38 068 005 3570</span>
                    <span><i class="fas fa-envelope"></i> TechZone@gmail.com</span>
                </div>
                <div class="user-actions">
                    <?php if (isset($_SESSION['client_id'])): ?>
                        <span>Welcome, <?php echo $_SESSION['client_fullname']; ?></span>
                        <a href="logout.php" class="ms-3">Logout</a>
                    <?php else: ?>
                        <a href="register.php" class="me-3">Register</a>
                        <a href="signin.php">Sign In</a>
                    <?php endif; ?>
                </div>
            </div>
        </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <div class="logoContainer">
                <img src="assets/logo.png" alt="TechZone Logo" class="img-fluid">
            </div>
            <a class="navbar-brand" href="home.php">TechZone</a>
            <div class="search-bar flex-grow-1 mx-4">
                <form class="input-group" method="GET" action="search.php">
                    <input type="text" class="form-control" placeholder="Search for products..." name="searchText" value="<?php echo isset($_GET['searchText']) ? htmlspecialchars($_GET['searchText']) : ''; ?>">
                    <select name="category" class="form-select" style="max-width: 150px;">
                        <option value="all">All Categories</option>
                        <?php foreach ($categories as $category): ?>
                            <option value="<?php echo $category; ?>" <?php if (isset($_GET['category']) && $_GET['category'] === $category) echo 'selected'; ?>>
                                <?php echo $category; ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i></button>
                </form>
            </div>
            <div class="user-controls">
                <a href="wishlist.php" class="btn btn-outline-secondary me-2">
                    <i class="far fa-heart"></i>
                    <span class="badge bg-danger"><?= $wishListCount ?></span>
                </a>
                <a href="cart.php" class="btn btn-outline-secondary">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge bg-danger"><?= $cartCount ?></span>
                </a>
            </div>
        </div>
    </nav>
</header>
